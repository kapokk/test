# 计算机网络


犯错：：：
3bit能表示多少个数？ 2的三次方个 ；；但是最大表示值不是6 是2的三次方-1


浮点数存储
符号位 尾数 和阶数
尾数默认为1xxxxxx 所以第一个1省去 实际上只存储xxxxx，还原时记得加上，这里存储的是二进制真值

阶码用移码存储表示 阶码十转二 
十进制下表示二进制小数点移动的位数（移动到小数点前只有一个1）阶数 + (2^8) -1(阶数位【float为8】)，然后再转成二进制，所得的就是移码

移码2转10：
二进制按照十进制解读，然后减去2^n ) -1 得到的k就是2的k次方

尾数二转十
尾数最左端补1,然后小数点从最左端1后面移动阶数位（阶数是2的n次方的n转成移码，需要还原），然后再转10进制，小数点后二分之一四分之一六分之一....

十进制小数转二进制
乘基取整法 *2 取整 剩下的位继续*2 知道小数部分剩下0

补码转原码（负数）
除符号位取反 然后加1 （不是减1）
原码转补码 （负数）
除符号位取反 加1

浮点数的特殊值
阶数全0 尾数全0 是正负0
阶数全0 尾数不为0 非规格化数 转十进制 ： 尾数位最左边补0（0.xxx）然后算出十进制 再*2的-126次方
阶数全1 尾数全0 正负无限
阶数全1 尾数不为0 NaN
求表示范围时注意阶数位不能全0 全1

多路选择器的控制信号位数
选择k路 则需要log2 k 向上取整个信号

组成原理看到浮点数

数据结构：

二叉排序树没有值相同的节点
平衡二叉树的插入，删除，平衡
插入小于向左大于向右 插入到根节点
删除：1，待删除节点的直接前驱，直接后继，没有就直接删除 2，替换直接前驱后继和待删除节点的位置 3， 删除待删除节点（此时在叶子处） 4， 寻找最小不平衡二叉树，调整直到平衡
旋转：
前置知识：因为平衡因子为正负1时，树平衡，要不平衡至少为2，所以寻找最小不平衡二叉树，寻找平衡因子为2的最小子树
寻找最小不平衡子树，如果为往下看成因，看哪边高，往下找两层，看是LL,RR,LR,RL ,LL 的L节点往右旋，RR往左，LR先左再右，RL先右再左，然后递归网上查找不平衡 lss




计算机网络（经常需要B,b,之类的单位转换）
在计算机网络中M,G,T的值是10的369次方，和其他科不一样

Internet是互联网  inter是局域网 局域网不限协议 互联网是tcpip
通信方式：电路通信，报文通信，分组通信，电路通信直接但占据链路，报文通信没有差错纠正，

网络性能指标
带宽 信道最多每秒传输多少比特 b/s
时延带宽积 信道传输时间*带宽 表示最大信道容量
时延 对于单个比特或者报文通信模式 发送时延+传输时延；；；对于分组通信模式需要画时序图来求和，不是简单的累加，时序图每条线表示一个节点，然后在上面画平行四边形，画法：数据从最左边竖线出发，先确定竖边长度为分组数据量/发送速率，然后看下一跳线，向下走传输时延的长度，画发送时延长度的线，然后封闭两条线为平行四边形，这是一个分组，下一个分组紧随其后，用相同的做法画，最后计算整个竖线耗时，发现时延不是（发送时延+传输时延）* 分组量【因为中间传输时延不是累加关系】
RTT：从一个分组发送完成后开始，到接受完确认消息结束，中间的耗时是RTT
吞吐量：传输时间/总时间



信道性能指标：
带宽：波形频率，单位HZ
码元：1个周期的波可以表示多少种信号
码元比特转换：k进制码元 就是log_2^k个比特
波特率：码元/秒
比特率:  比特每秒  k进制码元每秒 = log_2^k比特每秒
信噪比/分贝信噪比 :信号功率/噪声功率,这是信噪比，没有单位，分贝信噪比：10log_10^(S/N) 这是分贝信噪比 数值表达范围更窄；；注意做题时分辨题目中的信噪比是有单位信噪比还是无单位，算法不一样，有单位还要转换为无单位才能算香农

理想最高波特率：2W,W是频率
噪声信道最高比特率 KW*log_2^(1+S/N)

注意理想信道公式算的是波特率，噪声信道最高比特率算的是比特率

网络分层模型
OSI模型 ， TCPIP模型，教材模型
教材模型：物理层，数据链路层，网络层，传输层，应用层
OSI：物理层，数据链路层，网络层，传输层，会话层，表示层，应用层
TCPIP模型：网络接口层，网络层，传输层，应用层

OSI模型网络传输层和tcpip网络传输层的差别：
OSI模型网络传输层进行差错控制可靠传输流量控制 TCPIP的不进行差错控制可靠传输流量控制
UDP属于传输层的内容

循环冗余校验码的算法
基本元素：数据是待封装成循环冗余校验码的，通信双方商定一个生成多项式，循环冗余校验码分两部分1。数据部分 2.校验码
发送方校验码的计算
1.根据生成多项式P(X^n)构造除数，比如x^4 + 1对应的除数就是10001
2.数据扩容，在低位补0，补0的位数是除数的位数-1 ；；； 同时校验码的位数也是除数位数-1
3.进行一个特殊除法（异或除），其中得到的商不重要，不计算商，只关注余数
         除数右对齐，对齐到除数对应被除数首个不为0的元素
         进行异或运算，同0不同1
         得到的运算结果继续作为被除数进行异或除，如果被除数长度不够，就在根被除数上拉几位下来
         （终止条件是除法结果小于除数位数，并且根被除数没得借了）
         终止的除法结果就是校验位
4.把校验位加到数据低位，组成CRC校验码

接收方数据检错
用CRC码异或除约定生成多项式，直到终止时得最终商
商为0，正确，不为0，错误

可靠传输和流量控制 通过滑动窗口传输方法来实现，即重传ARQ协议
前置概念：丢序，数据帧，应答帧，超时重传，帧编号，滑动窗口n的长度 2^n>= 发送窗口+接收窗口
可靠传输和流量控制得实现要解决：数据帧丢失，应答帧丢失，数据帧出错，数据帧重复问题
停止等待协议（SW协议），发送方和接受方窗口大小为1，编号长度为1b（表示2个编号），发送方发送数据帧，接收方接收数据帧判断帧序号是否在滑动窗口内所需的阵序号内，校验是否通过，如果是则发送ACK，如果不是则不响应；；发送方超时没有收到应答帧重传

后退N帧数协议（GBN协议），发送窗口为N,接收窗口为1，发送方持续发送N帧数据，接收方接收数据返回ack，如果同时接收到N帧数据，则返回最后的有效数据的ACK，如果数据在接收者滑动窗口所需序列号之外或者校验未通过，则该数据无效，发送方如果第i帧超时没有收到ACK，则重新发送i和之后所有帧，如果接收到ACKi，说明i和之前的所有帧都传输完了；；；当数据帧丢失时，没有应答数据帧会超时，会发超时帧和之后的帧；；应答丢失也会重发；；；

选择重传协议（SR协议 select repeat）
发送窗口N,接收窗口m，m<n,发送窗口内每一帧，接收者每一帧ack，发送者每一帧超时没有收到ack重传，收到NAK否定帧重传，最左边帧确认后，发送窗口右移

可靠传输的信道利用率
发送窗口内所有数据时延/（发送到返回完第一个确认帧数的时延）
发送到返回完第一个确认帧数的时延 = data发送时延+数据传输时延*2 + ACK发送时延    ‘；；；； 对于重传和N帧数后退，信道利用率=NTD / (TD + RTT +TA)
信道利用率可以算最大通讯速率

码分复用和正交


可靠传输+冲突解决
aloha 立刻发送 随机重发
坚持监听csma 非坚持csma p坚持csma  及其优缺点
监听csma 监听为空，立即发送，发送失败随机重传
非坚持，监听为忙，随机时间后监听
p坚持csma，监听为空，p概率立即发送，1-p概率等待一段时间后继续监听

CSMA/CD协议
这个协议无冲突认为成功，不ACK
口诀 先听后发，边听边发，冲突停发，随机重发
概念：争用期，二进制指数退避算法，最大最小帧长，冲突检测分辨率
争用期：两倍最远单向传输时延
随即重发 等待时间为 r* 争用期 r的取值范围 取决于冲突次数，冲突小于10次 ，r属于(0,2^k -1) ,大于10次(2的10次方-1)
10，16
接收方处理
最短帧长 2*传播时延*带宽，小于这个视为无效帧
以太网最短最长帧长 ，64B,1518B
接收方帧处理 判断帧长丢弃，


CSMA/CA
口诀：发前监听，空闲间隔一段时间发，不空闲随机退避，退避使用随即退避，注意退避时会持续监听信道，只有信道不空闲时才继续倒计时
RTS CTS  请求帧，同意发送帧
DIFS 发送前等待时延
SIFS 接收方处理时延
DIFS > SIFS + 信道传播时延

令牌协议
令牌表示空闲，
令牌帧 数据帧 帧内容 令牌帧使用头尾和令牌号， 数据帧头尾+令牌好+数据+被使用号
令牌环网，小环组成大环

802.3 802.11局域网 以太局域网
8023是有线局域网 11是无线 以太局域网 MAC帧常规采用以太网的帧

双工通信不需要处理冲突 
无线局域网是星形拓扑结构
有线是总线型
光纤是点对点
MAC在数据链路层

同轴电缆只支持半双工
双绞线支持全双工或者半双工，在设备链接时决定
光纤只能全双工
集线器只支持半双工 交换机支持全双工

MAC地址位数？6B 
MAC帧的结构 662N4(B单位) 注意是先destination再source 然后是协议类型 数据 CRC
MAC发送帧前会发送同步8B的同步信号 是1010101最后是11 11说明开始发MAC 末尾的界定用违规曼彻斯特编码实现 编码使用曼彻斯特编码 （上0下1）
最短最长帧长 64到1500
交换机路由器有MAC地址 集线器没有
广播帧在同一个局域网内才能广播 路由器不转发广播帧
广播的实现 MAC地址全1就是广播
交换机隔离冲突域 路由器隔离广播域

局域网内广播：1 容易广播风暴 2.隐私性不好
引入虚拟局域网vlan
vlan 结构 划分方式 vid
vlan基于交换机实现 同时有基于接口的实现 基于MAC的实现 基于IP的实现
跨交换机通信使用802.1Q帧 6642N4 类似662N4 但是42部分是固定vlan识别号+随机+vid
同一个虚拟网共享一个vid

802.11协议
概念:BSS ESS SSID Portal 漫游 AP 帧分类 帧格式
AP wifi接入点
BSS 一个AP+多台主机
ESS 多个路由器和主机
SSID 服务集的id SS_id
漫游 主机从一个AP到另一个ap
采用802.11帧 有数据帧 控制帧(RTS,CTS,ACK) 管理帧（探测）
帧结构 控制，持续时间，AP MAC，source mac ， des mac 。。。后面省略


交换机原理
维护MAC路由表 设定超时丢弃 自动记录MAC对应端口号
转发方式 直接转发 处理MAC帧 662N4里的第一个6 也就是destination
存储转发 存储 差错校验 然后转发

网络层
ip数据报结构
首部+数据
首部：版本，首部长度单位4B,服务，数据报长度（以1B为单位），分片标识，标志位（后续是否还有分片，是否允许拆分），片偏移单位8B，源，目标，可选
注意 除了最后一部分，每一部分数据长度都要是8B的整数倍，最后一部分可以不是8B的整数倍  因为片偏移是8B

ip初版
主机号全0，主机号全1，网络号不为0，分别是表示本网络和网络内广播
n比特主机号能表示2^n - 2 个设备 有两个全零全1不行

子网掩码转发规则
目标ip & 子网掩码后和路由表的网络号对的上，就发

路由器的接的不同子网都要分配一个子网号

注意题型 可分配子网Ip号要减去2，因为全0 全1 不能分配给设备

CIDR划分 ， 变长子网划分
分配方式 从原子网号开始，每次加一位，左0右1，分配子网，剩下的位数-2 就是设备数

0.0.0.0是网络入口IP地址，目标是入口所在端口不转发（没有ip匹配不转发）

CIDR路由聚合 当路由表端口相同且子网号相同则合并 
CIDR最长前缀匹配原则 对于两个相同的ip ， 端口不同，优先选子网号更长的一个

NAT协议 内外网协议 维护一个内网+端口对应外网+端口表 每次穿越内外网边界时修改帧的ip 端口号 是传输层的协议

ARP MAC对应IP 协议有请求帧和响应帧 请求mac全1广播 因为是MAC帧 要符合最短长度 要填充

DHCP协议 是应用层协议 是UDp的应用 基于广播通信
四种帧 发现帧 主动上报mac  提供帧 提供ip地址 请求帧 客户向服务器请求 确认帧 服务器确认ip
四种都是广播 因为DHCp服务器同网络有多个 每个都需要知道i

ICMP协议 属于IP的子协议 封装在IP数据报内 负责报告网络间的一些一场消息
包括终点不可达 超时 参数错误 改变路由 ；；； 还有发请求和发回应（ping） 还有时间戳请求 和应答
对于一些特殊情况icmp不处理 比如来自0.0.0.0,127.0.0.1


IPV6 一百二十八位 用十六进制冒号分法表示 压缩表示：每个段之间前q个0可以省略，再压缩  连续出现的0用：：双冒号省略，但是双冒号只能有一个 ，多个不知道终结缺几个0
有单播多播本地播任一播等 支持新设备直接接入不需要DHCP 直接mac地址


IP路由协议
静态路由
动态路由 RIP OSPF
自治系统 bgp as号 内部网关协议 外部网关协议 自治区平级不包含

RIp
应用层协议 udp传输
有请求帧和应答帧
传输路由表 每个帧最多25个表 要拆分传
路由表格式 目标地址 跳数 下一跳路由器
固定时间交换 触发更新
RIP 十六跳 不可达

RIP的路由表更新
起始 只知道相邻网络的id
然后接收到rip报，进行修改，目标地址不变，跳数+1，下一跳地址改成数据来源
然后和本机路由表比较 如果目标网络是新的 加入 如果目标网络已存在，且下一跳一样 比较跳数 跳数小 更新 ；；下一跳不一样 目标地址一样 更新，以最新的为准

此外 RIP检查下一跳（邻居）150秒内不活着就不可达

RIP的特性
更短路由传得快 路由故障传得慢
RIp还会产生回环 所以用最远跳16来防止回环无线传播

OSPF路由协议
与RIP是应用层的协议不同 这是网络层的协议
包含5种类型数据
问候帧
数据库描述帧
链路状态请求帧
链路状态更新帧
链路确认帧
根据图数据库用djistra算法求到每个节点的最短路径

流程：
开机先检测直连网络
然后泛洪法（不能回流）广播自己的链路数据库
如果链路有变化 立即广播数据表最新
数据帧存储一个序号说明最新消息
支持真假信息鉴别

维护的路由表格式
目标 下一跳 代价 

作为内部路由协议 运行在自治区内 自治区里节点太多 ospf数据库负载大 又继续分区 分为主干区和非主干区 主干区至少有一个自治区边界路由器
分区内有区域内路由 和 区域边界路由

LSDB 链路状态数据库 LSA 链路通告 LSI链路描述信息


UDP协议
结构：源端口号，目标端口号，数据报长度（1B为单位），校验和；；；数据块 数据块受限于ip报数据块大小 65515B（65535-20)
不支持拆分 拥塞控制
校验和的计算：
对首部+数据进行校验和 校验和方法为整个数据报的每16位累加 累加完后取反 得到校验和
接收方拿到数据报后 整个数据报每16位相加 得到结果如果为全1 则正确 非全1 则错误
注意udp校验和计算前要加伪首部（源ip 目标ip 固定模板 udp数据报长度） 然后再校验和计算 发送方接收方都需要先加伪首部
校验和累加过程中最高位产生进位要加回最低位

于ip数据包不同 ip数据包校验和不要伪首部，而且只计算首部校验和 而udp是全数据


TCP协议
四个考点 连接管理 可靠传输 流量控制 拥塞控制
三次交替握手 四次交替挥手
可拆分
TCP数据包头部结构：源端口，目的端口，数据序号（当前报文数据相当于所有数据的第几个字节）seq，确认序号（确认第几个字节前都收到了）ack_seq[ack]，数据偏移（TCP帧中数据在多少个字节后（单位4B），保留，URG（紧急信息，另外编号，编号存在紧急指针），ACK（表示是应答帧），PSH（需要尽快回答），RST（终止连接），SYN（同步中，前两次握手报为1，其他时候0），FIN（1，3次挥手为1，其他为0），窗口大小(rwnd receive window)（确认号算起，接收方还有多大缓冲区,单位KB），，校验和（也要加伪首部），紧急指针（存放紧急数据序号），可变区间（存放单报文最大传输数据量)英文MSS max segment size

注意seq含义是第一个字节是序号几 而ack含义是序号几前已经接收完 也就是ack-1才是接收到的数据最后一个序号


三次握手过程和进程状态转换
1.客户端发送同步请求 syn=1,ACK=0,seq随机一个,ack_seq随便;;；；；进程状态转为同步已发送
2.服务器接收到同步请求 发送同步请求 syn=1,ack=1,seq随机，ack_seq固定是客户端的seq+1,；；；；；进程状态转为信号已收到
3.客户端收到同步请求，准备发送数据了，发送syn=0,ACK=1,seq=服务器同步帧的ack序号，ack是服务端请求帧的seq+1 ;;;第三次握手可以携带数据，如果携带数据，服务器接收到后下一次ack就收成功就要加数据大小（字节）；；；双方进程状态转为已建立连接
建立连接耗时1.5RTT 从开始建立到可以发送数据耗时1RTT

特性：TCP除了握手第一帧ACK为0 知道结束完ACK都为1  
握手建立的23次握手ack都要+1，都消耗数据序号 
挥手13次ack都要+1

四次挥手
FIN交替分别为1,0,1,0 ,收信息者每次都要ack=发送者 seq+1
挥手提出者刚提出还能发一次数据 后面不能发了，如果提出者没有在挥手时发送数据，被动者无需关闭等待直接发挥手3，然后主动者直接发挥手4，注意有个坑，这样的话被动者释放时间就是1.5RTT，主动者释放时间就是1RTT+2MSL 
MSL 是最长报文段时间 系统给定 
挥手过程 A说88，b说收到88了，B说88，A收到88 ，然后A看着B走远，双方收到 关闭
状态发送者先进入FIN_wait1 再进入fin_wait2 再进入time_wait （2MSL）再结束，，接收者先close wait ，lastack，然后close
注意挥手发送者要再见后主动等待2MSL

可靠传输
可靠传输分为确认机制和重传机制
确认机制特性
    延迟确认，确认时寻找最高seq顺序连续的数据的最后以字节的索引设为ack_seq 说明ack_seq前面的所有字节已收到
        如果接收方有数据发送，可以捎带在ACK确认帧中
        如果连续收到两个最大传输长度MSS的报文，立即ACK
        接收完数据之后，ACK时调整接收窗口剩余大小，ACK后尽快清空发送缓冲区

重传机制特性
超时重传
快重传（立即重传）：接收方确认机制变成每一个报都ack 不推迟，立即重传，发送方接收到四个确认号相同的ACK，重传确认号后的内容
超时重传就像ip路由协议里的GBN，快重传就像SR协议

流量控制
服务器和客户端都维持一个发送缓冲区，一个接收缓冲区，对于一方到另一方的通信，建立发送缓冲区和接收缓冲区，发送缓冲区存储已发送未确认或者未发送的数据，需要及时右移剔除已确认数据，且发送窗口大小随时根据接收者剩余缓冲区大小调整，接收缓冲区接收到的顺序数据应该尽快交付

TCP拥塞控制
口诀 慢开始 拥塞避免 拥塞解决 快重传 快恢复
相关概念 
拥塞窗口阈值 拥塞窗口（发送窗口）
怎么判断网络拥塞？ 如果ACK超时 则严重拥塞  如果连续收到4个相同ACK 则有点拥塞 拥塞严重时候执行拥塞解决算法 拥塞轻微时使用快恢复算法
发送方维护一个发送窗口（拥塞窗口），起始时，发送方采用慢开始算法，cwnd大小为1，然后每次收到ACK后立即*2（指数增长），直到达到拥塞窗口阈值，改用拥塞避免算法，改为线性增长（每次加1），且线性增长阶段单RTT内收到多次ACK，也只增长1，每RTT最多增长1
如果有ACK超时，说明网络严重拥塞，马上采用拥塞解决方法，cwnd改为1，拥塞阈值/2（乘法减小），然后继续慢增长
如果有连续4个相同ack收到，执行快恢复算法，cwnd 和 拥塞阈值同时改为 (cwnd/2), 然后继续使用拥塞避免模式

## 计网错题
<img width="821" height="177" alt="image" src="https://github.com/user-attachments/assets/c9bcf2bb-58a6-4458-b6a0-0e71d494d07a" />
理解RTT发送多少次数据出错
